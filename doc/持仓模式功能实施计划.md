# æŒä»“æ¨¡å¼åŠŸèƒ½å®æ–½è®¡åˆ’

> **æ–‡æ¡£è¯´æ˜**: æœ¬æ–‡æ¡£ä¸ºæ–°å¢"æŒä»“æ¨¡å¼"åŠŸèƒ½çš„å®æ–½è®¡åˆ’ï¼Œä½œä¸ºåç»­é¡¹ç›®æ”¹å†™çš„å‚è€ƒæ–‡æ¡£  
> **ç”Ÿæˆæ—¶é—´**: 2025-01-27  
> **åŠŸèƒ½éœ€æ±‚**: åœ¨ç°æœ‰ç›‘æ§æ¨¡å¼åŸºç¡€ä¸Šï¼Œæ–°å¢æŒä»“ç®¡ç†æ¨¡å¼ï¼ˆè®°å½•æŒä»“æ•°é‡ã€è´­ä¹°ä»·æ ¼ï¼ŒAIåˆ†æä¹°/å–å†³ç­–ï¼‰

---

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½éœ€æ±‚](#åŠŸèƒ½éœ€æ±‚)
- [è®¾è®¡æ–¹æ¡ˆ](#è®¾è®¡æ–¹æ¡ˆ)
- [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
- [ä»£ç ä¿®æ”¹æ¸…å•](#ä»£ç ä¿®æ”¹æ¸…å•)
- [é…ç½®ç¤ºä¾‹](#é…ç½®ç¤ºä¾‹)

---

## åŠŸèƒ½éœ€æ±‚

### éœ€æ±‚è¯´æ˜

**ä¸¤ç§è¿è¡Œæ¨¡å¼**:

1. **ç›‘æ§æ¨¡å¼ï¼ˆåŸæœ‰æ–¹å¼ï¼‰**
   - ä¸è¾“å…¥æŒä»“æ•°é‡å’Œè´­ä¹°ä»·æ ¼
   - æŒ‰ç…§åŸæ¥çš„æ–¹å¼è¿è¡Œ
   - çº¯æŠ€æœ¯åˆ†æï¼Œç»™å‡ºBUY/SELL/HOLDä¿¡å·

2. **æŒä»“æ¨¡å¼ï¼ˆæ–°å¢æ–¹å¼ï¼‰**
   - è¾“å…¥æŒä»“æ•°é‡å’Œè´­ä¹°ä»·æ ¼ï¼ˆå¯é€‰ï¼šè´­ä¹°æ—¥æœŸï¼‰
   - åœ¨åŸæœ‰æŠ€æœ¯åˆ†æåŸºç¡€ä¸Šï¼ŒæŠŠæŒä»“æ•°é‡å’Œæ¯è‚¡è´­ä¹°ä»·æ ¼ä¼ é€’ç»™AI
   - AIåŸºäºæŒä»“æˆæœ¬ä»·è¿›è¡Œåˆ†æ
   - åœ¨é€šçŸ¥ç»“æœä¸­æ˜¾ç¤ºæŒä»“æ­¢ç›ˆå’ŒæŒä»“æ­¢æŸä»·æ ¼

---

## è®¾è®¡æ–¹æ¡ˆ

### è®¾è®¡åŸåˆ™

1. **å‘åå…¼å®¹**: ä¸è¾“å…¥æŒä»“ä¿¡æ¯æ—¶ï¼ŒæŒ‰ç›‘æ§æ¨¡å¼è¿è¡Œï¼Œå®Œå…¨å…¼å®¹ç°æœ‰é…ç½®
2. **æœ€å°æ”¹åŠ¨**: ä»…æ‰©å±•é…ç½®å’Œæç¤ºè¯ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒåˆ†æé€»è¾‘
3. **çµæ´»é…ç½®**: æ”¯æŒä¸¤ç§æ¨¡å¼å…±å­˜ï¼ŒåŒä¸€é…ç½®æ–‡ä»¶ä¸­å¯ä»¥æ··åˆä½¿ç”¨

### åŠŸèƒ½æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®åŠ è½½                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ£€æŸ¥é…ç½®    â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
   æœ‰æŒä»“ä¿¡æ¯      æ— æŒä»“ä¿¡æ¯
    (æŒä»“æ¨¡å¼)     (ç›‘æ§æ¨¡å¼)
        â”‚             â”‚
        â–¼             â–¼
   è®¡ç®—ç›ˆäº      æŠ€æœ¯åˆ†æ
        â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ æ„å»ºAIæç¤ºè¯â”‚
       â”‚ (å«æŒä»“ä¿¡æ¯)â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ AIåˆ†æ      â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ ç”Ÿæˆé€šçŸ¥    â”‚
       â”‚ (å«æ­¢ç›ˆæ­¢æŸ)â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€æœ¯å®ç°

### 1. é…ç½®ç»“æ„æ‰©å±•

#### æ–‡ä»¶: `config/stock_config.go`

**ä¿®æ”¹ `StockItem` ç»“æ„**:

```go
// StockItem è‚¡ç¥¨é…ç½®é¡¹
type StockItem struct {
    Code                string  `json:"code"`
    Name                string  `json:"name"`
    Enabled             bool    `json:"enabled"`
    ScanIntervalMinutes int     `json:"scan_interval_minutes"`
    MinConfidence       int     `json:"min_confidence"`
    
    // æ–°å¢ï¼šæŒä»“æ¨¡å¼ç›¸å…³å­—æ®µï¼ˆå¯é€‰ï¼‰
    PositionQuantity    int     `json:"position_quantity,omitempty"` // æŒä»“æ•°é‡ï¼ˆè‚¡ï¼‰
    BuyPrice            float64 `json:"buy_price,omitempty"` // è´­ä¹°ä»·æ ¼ï¼ˆå…ƒ/è‚¡ï¼‰
    BuyDate             string  `json:"buy_date,omitempty"` // è´­ä¹°æ—¥æœŸï¼ˆYYYY-MM-DDï¼Œå¯é€‰ï¼‰
}
```

**æ·»åŠ è¾…åŠ©æ–¹æ³•**:

```go
// IsPositionMode åˆ¤æ–­æ˜¯å¦ä¸ºæŒä»“æ¨¡å¼
// æœ‰æŒä»“æ•°é‡ä¸”è´­ä¹°ä»·æ ¼>0æ—¶ï¼Œåˆ¤å®šä¸ºæŒä»“æ¨¡å¼
func (s *StockItem) IsPositionMode() bool {
    return s.PositionQuantity > 0 && s.BuyPrice > 0
}

// SetDefaults è®¾ç½®é»˜è®¤å€¼
func (s *StockItem) SetDefaults() {
    if s.ScanIntervalMinutes <= 0 {
        s.ScanIntervalMinutes = 5
    }
    if s.MinConfidence <= 0 {
        s.MinConfidence = 70
    }
}
```

**æ›´æ–°é…ç½®éªŒè¯**:

```go
// åœ¨ Validate() æ–¹æ³•ä¸­æ·»åŠ ï¼ˆåœ¨éªŒè¯è‚¡ç¥¨é…ç½®çš„å¾ªç¯ä¸­ï¼‰
for i, stock := range c.Stocks {
    stock.SetDefaults()
    
    // å¦‚æœå¡«å†™äº†æŒä»“æ•°é‡æˆ–è´­ä¹°ä»·æ ¼ï¼Œå¿…é¡»ä¸¤è€…éƒ½å¡«å†™
    if (stock.PositionQuantity > 0 && stock.BuyPrice <= 0) ||
       (stock.PositionQuantity <= 0 && stock.BuyPrice > 0) {
        return fmt.Errorf("stocks[%d]: æŒä»“æ•°é‡å’Œè´­ä¹°ä»·æ ¼å¿…é¡»åŒæ—¶å¡«å†™", i)
    }
    
    if stock.PositionQuantity < 0 {
        return fmt.Errorf("stocks[%d]: æŒä»“æ•°é‡ä¸èƒ½ä¸ºè´Ÿæ•°", i)
    }
    
    if stock.BuyPrice < 0 {
        return fmt.Errorf("stocks[%d]: è´­ä¹°ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°", i)
    }
    
    // ... å…¶ä»–éªŒè¯ ...
}
```

---

### 2. æŒä»“ä¿¡æ¯è®¡ç®—

#### æ–°å»ºæ–‡ä»¶: `stock/position.go`

```go
package stock

import (
    "fmt"
    "time"
)

// PositionInfo æŒä»“ä¿¡æ¯
type PositionInfo struct {
    StockCode         string    `json:"stock_code"`
    StockName         string    `json:"stock_name"`
    Quantity          int       `json:"quantity"`        // æŒä»“æ•°é‡ï¼ˆè‚¡ï¼‰
    BuyPrice          float64   `json:"buy_price"`       // è´­ä¹°ä»·æ ¼ï¼ˆå…ƒ/è‚¡ï¼‰
    BuyDate           time.Time `json:"buy_date"`        // è´­ä¹°æ—¥æœŸ
    CurrentPrice      float64   `json:"current_price"`   // å½“å‰ä»·æ ¼ï¼ˆå…ƒ/è‚¡ï¼‰
    TotalCost         float64   `json:"total_cost"`      // æŒä»“æˆæœ¬ï¼ˆå…ƒï¼‰
    MarketValue       float64   `json:"market_value"`    // å¸‚å€¼ï¼ˆå…ƒï¼‰
    ProfitLoss        float64   `json:"profit_loss"`     // æµ®åŠ¨ç›ˆäºï¼ˆå…ƒï¼‰
    ProfitLossPercent float64   `json:"profit_loss_percent"` // ç›ˆäºæ¯”ä¾‹ï¼ˆ%ï¼‰
}

// CalculatePositionInfo è®¡ç®—æŒä»“ä¿¡æ¯
func CalculatePositionInfo(code, name string, quantity int, buyPrice, currentPrice float64, buyDate time.Time) *PositionInfo {
    totalCost := buyPrice * float64(quantity)
    marketValue := currentPrice * float64(quantity)
    profitLoss := marketValue - totalCost
    profitLossPercent := 0.0
    if buyPrice > 0 {
        profitLossPercent = ((currentPrice - buyPrice) / buyPrice) * 100.0
    }
    
    return &PositionInfo{
        StockCode:         code,
        StockName:         name,
        Quantity:          quantity,
        BuyPrice:          buyPrice,
        BuyDate:           buyDate,
        CurrentPrice:      currentPrice,
        TotalCost:         totalCost,
        MarketValue:       marketValue,
        ProfitLoss:        profitLoss,
        ProfitLossPercent: profitLossPercent,
    }
}

// FormatProfitLoss æ ¼å¼åŒ–ç›ˆäºæ˜¾ç¤º
func (p *PositionInfo) FormatProfitLoss() string {
    sign := "+"
    if p.ProfitLoss < 0 {
        sign = ""
    }
    return fmt.Sprintf("%s%.2få…ƒ (%.2f%%)", sign, p.ProfitLoss, p.ProfitLossPercent)
}
```

---

### 3. åˆ†æé…ç½®æ‰©å±•

#### æ–‡ä»¶: `stock/analyzer.go`

**ä¿®æ”¹ `AnalysisConfig` ç»“æ„**:

```go
// AnalysisConfig åˆ†æé…ç½®
type AnalysisConfig struct {
    StockCode          string
    StockName          string
    ScanInterval       time.Duration
    EnableNotification bool
    MinConfidence      int
    
    // æ–°å¢ï¼šæŒä»“ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    PositionQuantity   int       // æŒä»“æ•°é‡ï¼ˆè‚¡ï¼‰ï¼Œ0è¡¨ç¤ºç›‘æ§æ¨¡å¼
    BuyPrice           float64   // è´­ä¹°ä»·æ ¼ï¼ˆå…ƒ/è‚¡ï¼‰ï¼Œ0è¡¨ç¤ºç›‘æ§æ¨¡å¼
    BuyDate            time.Time // è´­ä¹°æ—¥æœŸï¼ˆå¯é€‰ï¼‰
}

// IsPositionMode åˆ¤æ–­æ˜¯å¦ä¸ºæŒä»“æ¨¡å¼
func (c *AnalysisConfig) IsPositionMode() bool {
    return c.PositionQuantity > 0 && c.BuyPrice > 0
}
```

---

### 4. AIæç¤ºè¯å¢å¼º

#### æ–‡ä»¶: `stock/analyzer.go`

**ä¿®æ”¹ `buildAnalysisPrompt` æ–¹æ³•**:

åœ¨æ–¹æ³•ä¸­ï¼Œåœ¨æ·»åŠ æŠ€æœ¯æŒ‡æ ‡ä¹‹åï¼Œæ£€æµ‹æ˜¯å¦ä¸ºæŒä»“æ¨¡å¼ï¼Œå¦‚æœæ˜¯åˆ™æ·»åŠ æŒä»“ä¿¡æ¯ï¼š

```go
// åœ¨ buildAnalysisPrompt æ–¹æ³•ä¸­ï¼Œåœ¨æ·»åŠ æŠ€æœ¯æŒ‡æ ‡ä¹‹åæ·»åŠ 

// æ£€æŸ¥æ˜¯å¦ä¸ºæŒä»“æ¨¡å¼
if a.AnalysisConfig.IsPositionMode() {
    currentPrice := technical["current_price"].(float64)
    positionInfo := CalculatePositionInfo(
        a.AnalysisConfig.StockCode,
        a.AnalysisConfig.StockName,
        a.AnalysisConfig.PositionQuantity,
        a.AnalysisConfig.BuyPrice,
        currentPrice,
        a.AnalysisConfig.BuyDate,
    )
    
    prompt += fmt.Sprintf(`
## æŒä»“ä¿¡æ¯
- **æŒä»“æ•°é‡**: %dè‚¡
- **è´­ä¹°ä»·æ ¼**: %.2få…ƒ/è‚¡
- **æŒä»“æˆæœ¬**: %.2få…ƒ
- **å½“å‰ä»·æ ¼**: %.2få…ƒ/è‚¡
- **å¸‚å€¼**: %.2få…ƒ
- **æµ®åŠ¨ç›ˆäº**: %s

`,
        positionInfo.Quantity,
        positionInfo.BuyPrice,
        positionInfo.TotalCost,
        positionInfo.CurrentPrice,
        positionInfo.MarketValue,
        positionInfo.FormatProfitLoss(),
    )
    
    // ä¿®æ”¹åˆ†æè¦æ±‚ï¼Œæ·»åŠ æŒä»“è¯„ä¼°
    prompt += `
## åˆ†æè¦æ±‚

è¯·åŸºäºä»¥ä¸Šæ•°æ®ï¼ˆåŒ…æ‹¬æŒä»“ä¿¡æ¯ï¼‰è¿›è¡Œ**å…¨é¢çš„æŠ€æœ¯åˆ†æå’ŒæŒä»“è¯„ä¼°**ï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„æ“ä½œå»ºè®®ã€‚åˆ†ææ—¶è¯·è€ƒè™‘ï¼š

1. **è¶‹åŠ¿åˆ†æ**: å½“å‰ä»·æ ¼ä¸å‡çº¿çš„å…³ç³»ï¼Œæ˜¯å¦å¤„äºä¸Šå‡/ä¸‹é™/ç›˜æ•´è¶‹åŠ¿
2. **é‡ä»·å…³ç³»**: æˆäº¤é‡çš„å˜åŒ–æ˜¯å¦æ”¯æŒä»·æ ¼èµ°åŠ¿
3. **ç›˜å£åˆ†æ**: ä¹°å–ç›˜åŠ›é‡å¯¹æ¯”ï¼Œå¤§å•æƒ…å†µ
4. **æŠ€æœ¯æŒ‡æ ‡**: RSIæ˜¯å¦è¶…ä¹°è¶…å–ï¼Œå‡çº¿æ’åˆ—æƒ…å†µ
5. **æŒä»“è¯„ä¼°**: 
   - å½“å‰ç›ˆäºæƒ…å†µæ˜¯å¦è¾¾åˆ°é¢„æœŸ
   - æ˜¯å¦åº”è¯¥æ­¢ç›ˆæˆ–æ­¢æŸ
   - æ˜¯å¦åº”è¯¥åŠ ä»“æˆ–å‡ä»“
   - æŒä»“æˆæœ¬ä»·ä¸å½“å‰ä»·æ ¼çš„å…³ç³»
6. **é£é™©è¯„ä¼°**: å½“å‰ä½ç½®çš„é£é™©æ”¶ç›Šæ¯”

**ç‰¹åˆ«è¦æ±‚**: å¦‚æœå»ºè®®å–å‡ºæˆ–æŒæœ‰ï¼Œè¯·æ ¹æ®æŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æï¼Œæ˜ç¡®ç»™å‡ºï¼š
- **æŒä»“æ­¢ç›ˆä»·**: å»ºè®®çš„æ­¢ç›ˆä»·æ ¼ï¼ˆå…ƒï¼‰
- **æŒä»“æ­¢æŸä»·**: å»ºè®®çš„æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼‰

## è¾“å‡ºæ ¼å¼

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼ˆåªè¾“å‡ºJSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ï¼‰:

` + "```json" + `
{
  "signal": "BUY æˆ– SELL æˆ– HOLD",
  "confidence": 0-100çš„æ•´æ•°ï¼ˆä¿¡å¿ƒåº¦ï¼Œè¶Šé«˜è¶Šç¡®å®šï¼‰,
  "reasoning": "è¯¦ç»†çš„åˆ†æç†ç”±ï¼ŒåŒ…å«å…³é”®æŠ€æœ¯æŒ‡æ ‡ã€æŒä»“è¯„ä¼°å’Œé€»è¾‘",
  "target_price": ç›®æ ‡ä»·æ ¼ï¼ˆå…ƒï¼Œæ•°å­—ï¼‰ï¼Œå¦‚æœæ˜¯SELLæˆ–HOLDå¯ä»¥ä¸º0,
  "stop_loss": æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼Œæ•°å­—ï¼‰ï¼Œå¦‚æœæ˜¯HOLDå¯ä»¥ä¸º0,
  "risk_reward": "é£é™©å›æŠ¥æ¯”ï¼Œä¾‹å¦‚ 1:2 æˆ– 1:3",
  "position_profit_target": æŒä»“æ­¢ç›ˆä»·æ ¼ï¼ˆå…ƒï¼Œæ•°å­—ï¼‰ï¼ŒåŸºäºæŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æç»™å‡º,
  "position_stop_loss": æŒä»“æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼Œæ•°å­—ï¼‰ï¼ŒåŸºäºæŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æç»™å‡º
}
` + "```" + `

**æ³¨æ„äº‹é¡¹**:
- signal: BUYï¼ˆå»ºè®®ä¹°å…¥/åŠ ä»“ï¼‰ã€SELLï¼ˆå»ºè®®å–å‡ºï¼‰ã€HOLDï¼ˆå»ºè®®æŒæœ‰ï¼‰
- position_profit_target: æŒä»“æ­¢ç›ˆä»·ï¼Œåº”è¯¥é«˜äºè´­ä¹°ä»·æ ¼ï¼ˆå¦‚æœç›ˆåˆ©ï¼‰æˆ–å½“å‰ä»·æ ¼ï¼ˆå¦‚æœäºæŸä½†çœ‹æ¶¨ï¼‰
- position_stop_loss: æŒä»“æ­¢æŸä»·ï¼Œåº”è¯¥ä½äºè´­ä¹°ä»·æ ¼ï¼ˆå¦‚æœç›ˆåˆ©ï¼‰æˆ–å½“å‰ä»·æ ¼ï¼ˆå¦‚æœäºæŸï¼‰
- å¦‚æœæ˜¯ç›‘æ§æ¨¡å¼ï¼ˆæ— æŒä»“ï¼‰ï¼Œposition_profit_target å’Œ position_stop_loss å¯ä»¥ä¸º0
`
} else {
    // åŸæœ‰çš„ç›‘æ§æ¨¡å¼åˆ†æè¦æ±‚ï¼ˆä¿æŒä¸å˜ï¼‰
    // ...
}
```

---

### 5. AIå“åº”è§£ææ‰©å±•

#### æ–‡ä»¶: `stock/ai_parser.go`

**æ‰©å±• `AIDecisionResponse` ç»“æ„**:

```go
// AIDecisionResponse AIå†³ç­–å“åº”
type AIDecisionResponse struct {
    Signal                string  `json:"signal"`                  // BUY/SELL/HOLD
    Confidence            int     `json:"confidence"`              // 0-100
    Reasoning             string  `json:"reasoning"`               // åˆ†æç†ç”±
    TargetPrice           float64 `json:"target_price"`            // ç›®æ ‡ä»·
    StopLoss              float64 `json:"stop_loss"`               // æ­¢æŸä»·
    RiskReward            string  `json:"risk_reward"`             // é£é™©å›æŠ¥æ¯”
    
    // æ–°å¢ï¼šæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
    PositionProfitTarget  float64 `json:"position_profit_target"`  // æŒä»“æ­¢ç›ˆä»·
    PositionStopLoss      float64 `json:"position_stop_loss"`      // æŒä»“æ­¢æŸä»·
}
```

**æ‰©å±• `AnalysisResult` ç»“æ„**:

```go
// AnalysisResult åˆ†æç»“æœ
type AnalysisResult struct {
    StockCode     string                 `json:"stock_code"`
    StockName     string                 `json:"stock_name"`
    CurrentPrice  float64                `json:"current_price"`
    Signal        string                 `json:"signal"` // BUY/SELL/HOLD
    Confidence    int                    `json:"confidence"`
    Reasoning     string                 `json:"reasoning"`
    TargetPrice   float64                `json:"target_price,omitempty"`
    StopLoss      float64                `json:"stop_loss,omitempty"`
    RiskReward    string                 `json:"risk_reward,omitempty"`
    TechnicalData map[string]interface{} `json:"technical_data"`
    Timestamp     time.Time              `json:"timestamp"`
    
    // æ–°å¢ï¼šæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼ï¼ˆæŒä»“æ¨¡å¼ä¸‹æœ‰æ•ˆï¼‰
    PositionProfitTarget float64         `json:"position_profit_target,omitempty"` // æŒä»“æ­¢ç›ˆä»·
    PositionStopLoss     float64         `json:"position_stop_loss,omitempty"`     // æŒä»“æ­¢æŸä»·
    PositionInfo         *PositionInfo   `json:"position_info,omitempty"`          // æŒä»“ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
}
```

**ä¿®æ”¹ `ConvertToAnalysisResult` å‡½æ•°**:

```go
// ConvertToAnalysisResult å°†AIå†³ç­–è½¬æ¢ä¸ºåˆ†æç»“æœ
func ConvertToAnalysisResult(aiDecision *AIDecisionResponse, stockCode, stockName string, currentPrice float64, technical map[string]interface{}) *AnalysisResult {
    return &AnalysisResult{
        StockCode:          stockCode,
        StockName:          stockName,
        CurrentPrice:       currentPrice,
        Signal:             aiDecision.Signal,
        Confidence:         aiDecision.Confidence,
        Reasoning:          aiDecision.Reasoning,
        TargetPrice:        aiDecision.TargetPrice,
        StopLoss:           aiDecision.StopLoss,
        RiskReward:         aiDecision.RiskReward,
        TechnicalData:      technical,
        Timestamp:          time.Now(),
        
        // æ–°å¢ï¼šæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
        PositionProfitTarget: aiDecision.PositionProfitTarget,
        PositionStopLoss:     aiDecision.PositionStopLoss,
    }
}
```

---

### 6. ä¸»ç¨‹åºé€‚é…

#### æ–‡ä»¶: `main_stock.go`

**ä¿®æ”¹åˆ›å»ºåˆ†æå™¨çš„ä»£ç **:

```go
// åœ¨åˆ›å»ºåˆ†æå™¨çš„å¾ªç¯ä¸­
for _, stockItem := range enabledStocks {
    analysisConfig := &stock.AnalysisConfig{
        StockCode:          stockItem.Code,
        StockName:          stockItem.Name,
        ScanInterval:       stockItem.GetScanInterval(),
        EnableNotification: cfg.Notification.Enabled,
        MinConfidence:      stockItem.MinConfidence,
        
        // æ–°å¢ï¼šæŒä»“ä¿¡æ¯ï¼ˆå¦‚æœå¡«å†™äº†ï¼‰
        PositionQuantity:   stockItem.PositionQuantity,
        BuyPrice:           stockItem.BuyPrice,
        BuyDate:            parseBuyDate(stockItem.BuyDate),
    }
    
    analyzer := stock.NewStockAnalyzer(tdxClient, mcpClient, notif, analysisConfig, tradingTimeChecker)
    analyzerManager.AddAnalyzer(stockItem.Code, analyzer)
}

// æ·»åŠ è¾…åŠ©å‡½æ•°
func parseBuyDate(dateStr string) time.Time {
    if dateStr == "" {
        return time.Time{} // é›¶å€¼
    }
    t, err := time.Parse("2006-01-02", dateStr)
    if err != nil {
        log.Printf("âš ï¸  è§£æè´­ä¹°æ—¥æœŸå¤±è´¥: %vï¼Œå°†å¿½ç•¥è¯¥å­—æ®µ", err)
        return time.Time{}
    }
    return t
}
```

---

### 7. é€šçŸ¥å¢å¼º

#### æ–‡ä»¶: `notifier/webhook.go`

**æ‰©å±• `TradingSignal` ç»“æ„**:

```go
// TradingSignal äº¤æ˜“ä¿¡å·
type TradingSignal struct {
    StockCode            string  `json:"stock_code"`
    StockName            string  `json:"stock_name"`
    CurrentPrice         float64 `json:"current_price"`
    Signal               string  `json:"signal"` // BUY/SELL/HOLD
    Confidence           int     `json:"confidence"`
    Reasoning            string  `json:"reasoning"`
    TargetPrice          float64 `json:"target_price,omitempty"`
    StopLoss             float64 `json:"stop_loss,omitempty"`
    RiskReward           string  `json:"risk_reward,omitempty"`
    Timestamp            string  `json:"timestamp"`
    
    // æ–°å¢ï¼šæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
    PositionProfitTarget float64 `json:"position_profit_target,omitempty"` // æŒä»“æ­¢ç›ˆä»·
    PositionStopLoss     float64 `json:"position_stop_loss,omitempty"`     // æŒä»“æ­¢æŸä»·
    PositionInfo         *stock.PositionInfo `json:"position_info,omitempty"` // æŒä»“ä¿¡æ¯
}
```

**ä¿®æ”¹ `formatSignalMarkdown` æ–¹æ³•ï¼ˆé’‰é’‰é€šçŸ¥ï¼‰**:

```go
// formatSignalMarkdown æ ¼å¼åŒ–ä¿¡å·ä¸ºMarkdownï¼ˆé’‰é’‰ï¼‰
func formatSignalMarkdown(signal *TradingSignal) string {
    // ... åŸæœ‰çš„æ ¼å¼ä»£ç  ...
    
    // å¦‚æœæœ‰æŒä»“ä¿¡æ¯ï¼Œæ·»åŠ æŒä»“ç›ˆäº
    if signal.PositionInfo != nil {
        markdown += fmt.Sprintf("**æŒä»“æ•°é‡**: %dè‚¡\n\n", signal.PositionInfo.Quantity)
        markdown += fmt.Sprintf("**è´­ä¹°ä»·æ ¼**: %.2få…ƒ/è‚¡\n\n", signal.PositionInfo.BuyPrice)
        markdown += fmt.Sprintf("**å½“å‰ä»·æ ¼**: %.2få…ƒ/è‚¡\n\n", signal.PositionInfo.CurrentPrice)
        markdown += fmt.Sprintf("**æµ®åŠ¨ç›ˆäº**: %s\n\n", signal.PositionInfo.FormatProfitLoss())
        
        // æ·»åŠ æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
        if signal.PositionProfitTarget > 0 {
            markdown += fmt.Sprintf("**ğŸ“ˆ æŒä»“æ­¢ç›ˆä»·**: %.2få…ƒ\n\n", signal.PositionProfitTarget)
        }
        if signal.PositionStopLoss > 0 {
            markdown += fmt.Sprintf("**ğŸ“‰ æŒä»“æ­¢æŸä»·**: %.2få…ƒ\n\n", signal.PositionStopLoss)
        }
    }
    
    // ... å…¶ä»–æ ¼å¼ä»£ç  ...
    
    return markdown
}
```

**ä¿®æ”¹ `formatSignalRichText` æ–¹æ³•ï¼ˆé£ä¹¦é€šçŸ¥ï¼‰**:

```go
// formatSignalRichText æ ¼å¼åŒ–ä¿¡å·ä¸ºå¯Œæ–‡æœ¬å¡ç‰‡ï¼ˆé£ä¹¦ï¼‰
func formatSignalRichText(signal *TradingSignal) map[string]interface{} {
    // ... åŸæœ‰çš„å¡ç‰‡ç»“æ„ä»£ç  ...
    
    // æ„å»ºå­—æ®µåˆ—è¡¨
    fields := []map[string]interface{}{
        // ... åŸæœ‰å­—æ®µ ...
    }
    
    // å¦‚æœæœ‰æŒä»“ä¿¡æ¯ï¼Œæ·»åŠ æŒä»“ç›¸å…³å­—æ®µ
    if signal.PositionInfo != nil {
        fields = append(fields,
            map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**æŒä»“æ•°é‡**: %dè‚¡", signal.PositionInfo.Quantity),
                },
            },
            map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**è´­ä¹°ä»·æ ¼**: %.2få…ƒ/è‚¡", signal.PositionInfo.BuyPrice),
                },
            },
            map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**å½“å‰ä»·æ ¼**: %.2få…ƒ/è‚¡", signal.PositionInfo.CurrentPrice),
                },
            },
            map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**æµ®åŠ¨ç›ˆäº**: %s", signal.PositionInfo.FormatProfitLoss()),
                },
            },
        )
        
        // æ·»åŠ æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
        if signal.PositionProfitTarget > 0 {
            fields = append(fields, map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**ğŸ“ˆ æŒä»“æ­¢ç›ˆä»·**: %.2få…ƒ", signal.PositionProfitTarget),
                },
            })
        }
        if signal.PositionStopLoss > 0 {
            fields = append(fields, map[string]interface{}{
                "is_short": false,
                "text": map[string]interface{}{
                    "tag":  "lark_md",
                    "content": fmt.Sprintf("**ğŸ“‰ æŒä»“æ­¢æŸä»·**: %.2få…ƒ", signal.PositionStopLoss),
                },
            })
        }
    }
    
    // ... å…¶ä»–ä»£ç  ...
    
    return card
}
```

**ä¿®æ”¹ `SendSignal` æ–¹æ³•**:

```go
// SendSignal å‘é€äº¤æ˜“ä¿¡å·
func (n *Notifier) SendSignal(result *stock.AnalysisResult) error {
    signal := &TradingSignal{
        StockCode:          result.StockCode,
        StockName:          result.StockName,
        CurrentPrice:       result.CurrentPrice,
        Signal:             result.Signal,
        Confidence:         result.Confidence,
        Reasoning:          result.Reasoning,
        TargetPrice:        result.TargetPrice,
        StopLoss:           result.StopLoss,
        RiskReward:         result.RiskReward,
        Timestamp:          result.Timestamp.Format("2006-01-02 15:04:05"),
        
        // æ–°å¢ï¼šæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
        PositionProfitTarget: result.PositionProfitTarget,
        PositionStopLoss:     result.PositionStopLoss,
        PositionInfo:         result.PositionInfo,
    }
    
    // ... å…¶ä»–ä»£ç  ...
}
```

**ä¿®æ”¹ `Analyze` æ–¹æ³•ï¼Œä¼ é€’æŒä»“ä¿¡æ¯åˆ°ç»“æœ**:

åœ¨ `stock/analyzer.go` çš„ `Analyze` æ–¹æ³•ä¸­ï¼Œåœ¨è§£æAIå“åº”åï¼š

```go
// 8. è§£æAIå“åº”
result, err := a.parseAIResponse(aiResponse, quote, technicalData)
if err != nil {
    return nil, fmt.Errorf("è§£æAIå“åº”å¤±è´¥: %w", err)
}

// 9. å¦‚æœæ˜¯æŒä»“æ¨¡å¼ï¼Œè®¡ç®—å¹¶æ·»åŠ æŒä»“ä¿¡æ¯
if a.AnalysisConfig.IsPositionMode() {
    currentPrice := technicalData["current_price"].(float64)
    positionInfo := CalculatePositionInfo(
        a.AnalysisConfig.StockCode,
        a.AnalysisConfig.StockName,
        a.AnalysisConfig.PositionQuantity,
        a.AnalysisConfig.BuyPrice,
        currentPrice,
        a.AnalysisConfig.BuyDate,
    )
    result.PositionInfo = positionInfo
}

// 10. å‘é€é€šçŸ¥ï¼ˆå¦‚æœå¯ç”¨ä¸”ä¿¡å¿ƒåº¦è¾¾åˆ°é˜ˆå€¼ï¼‰
// ... åŸæœ‰ä»£ç  ...
```

---

### 8. Webç•Œé¢æ‰©å±•

#### æ–‡ä»¶: `web/config.html`

**ä¿®æ”¹è‚¡ç¥¨é…ç½®é¡¹æ¸²æŸ“**:

åœ¨ `renderStockList` å‡½æ•°ä¸­ï¼Œåœ¨"å¯ç”¨æ­¤è‚¡ç¥¨"å¤é€‰æ¡†åæ·»åŠ ï¼š

```html
<!-- æŒä»“ä¿¡æ¯åŒºåŸŸ -->
<div class="form-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <label style="font-weight: bold; color: #555;">ğŸ“Š æŒä»“ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</label>
    <small style="display: block; color: #999; margin-bottom: 10px;">å¦‚æœä¸å¡«å†™ï¼Œå°†æŒ‰ç›‘æ§æ¨¡å¼è¿è¡Œï¼ˆä»…æŠ€æœ¯åˆ†æï¼‰</small>
    <div class="grid-2">
        <div class="form-group">
            <label>æŒä»“æ•°é‡ï¼ˆè‚¡ï¼‰</label>
            <input type="number" class="stock-position-quantity" data-index="${index}" value="${stock.position_quantity || ''}" placeholder="1000">
        </div>
        <div class="form-group">
            <label>è´­ä¹°ä»·æ ¼ï¼ˆå…ƒ/è‚¡ï¼‰</label>
            <input type="number" step="0.01" class="stock-buy-price" data-index="${index}" value="${stock.buy_price || ''}" placeholder="12.50">
        </div>
    </div>
    <div class="form-group">
        <label>è´­ä¹°æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label>
        <input type="date" class="stock-buy-date" data-index="${index}" value="${stock.buy_date || ''}">
        <small>è´­ä¹°æ—¥æœŸï¼Œç”¨äºè®¡ç®—æŒä»“å¤©æ•°</small>
    </div>
</div>
```

**ä¿®æ”¹æ•°æ®æ”¶é›†å‡½æ•°**:

åœ¨ `collectFormData` å‡½æ•°ä¸­ï¼Œæ”¶é›†è‚¡ç¥¨æ•°æ®æ—¶åŒ…å«æŒä»“ä¿¡æ¯ï¼š

```javascript
// æ”¶é›†è‚¡ç¥¨æ•°æ®
const stockCodes = document.querySelectorAll('.stock-code');
stockCodes.forEach((input, index) => {
    const stock = {
        code: input.value,
        name: document.querySelector(`.stock-name[data-index="${index}"]`).value,
        enabled: document.querySelector(`.stock-enabled[data-index="${index}"]`).checked,
        scan_interval_minutes: parseInt(document.querySelector(`.stock-interval[data-index="${index}"]`).value) || 5,
        min_confidence: parseInt(document.querySelector(`.stock-confidence[data-index="${index}"]`).value) || 70
    };
    
    // æ”¶é›†æŒä»“ä¿¡æ¯ï¼ˆå¦‚æœå¡«å†™äº†ï¼‰
    const quantity = document.querySelector(`.stock-position-quantity[data-index="${index}"]`).value;
    const price = document.querySelector(`.stock-buy-price[data-index="${index}"]`).value;
    const buyDate = document.querySelector(`.stock-buy-date[data-index="${index}"]`).value;
    
    if (quantity && price) {
        stock.position_quantity = parseInt(quantity);
        stock.buy_price = parseFloat(price);
        if (buyDate) {
            stock.buy_date = buyDate;
        }
    }
    
    config.stocks.push(stock);
});
```

---

## ä»£ç ä¿®æ”¹æ¸…å•

### å¿…é¡»ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `config/stock_config.go`

- [ ] æ‰©å±• `StockItem` ç»“æ„ï¼Œæ·»åŠ  `PositionQuantity`, `BuyPrice`, `BuyDate` å­—æ®µ
- [ ] æ·»åŠ  `IsPositionMode()` æ–¹æ³•
- [ ] æ·»åŠ  `SetDefaults()` æ–¹æ³•
- [ ] æ›´æ–° `Validate()` æ–¹æ³•ï¼ŒéªŒè¯æŒä»“ä¿¡æ¯

#### 2. `stock/position.go` (æ–°å»º)

- [ ] åˆ›å»º `PositionInfo` ç»“æ„
- [ ] å®ç° `CalculatePositionInfo` å‡½æ•°
- [ ] å®ç° `FormatProfitLoss` æ–¹æ³•

#### 3. `stock/analyzer.go`

- [ ] æ‰©å±• `AnalysisConfig` ç»“æ„ï¼Œæ·»åŠ æŒä»“å­—æ®µ
- [ ] æ·»åŠ  `IsPositionMode()` æ–¹æ³•
- [ ] ä¿®æ”¹ `buildAnalysisPrompt` æ–¹æ³•ï¼Œæ·»åŠ æŒä»“ä¿¡æ¯åˆ°æç¤ºè¯
- [ ] ä¿®æ”¹ `Analyze` æ–¹æ³•ï¼Œè®¡ç®—å¹¶ä¼ é€’æŒä»“ä¿¡æ¯

#### 4. `stock/ai_parser.go`

- [ ] æ‰©å±• `AIDecisionResponse` ç»“æ„ï¼Œæ·»åŠ  `PositionProfitTarget`, `PositionStopLoss` å­—æ®µ
- [ ] æ‰©å±• `AnalysisResult` ç»“æ„ï¼Œæ·»åŠ æŒä»“ç›¸å…³å­—æ®µ
- [ ] ä¿®æ”¹ `ConvertToAnalysisResult` å‡½æ•°ï¼ŒåŒ…å«æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼

#### 5. `main_stock.go`

- [ ] ä¿®æ”¹åˆ›å»ºåˆ†æå™¨çš„ä»£ç ï¼Œä¼ é€’æŒä»“ä¿¡æ¯
- [ ] æ·»åŠ  `parseBuyDate` è¾…åŠ©å‡½æ•°

#### 6. `notifier/webhook.go`

- [ ] æ‰©å±• `TradingSignal` ç»“æ„ï¼Œæ·»åŠ æŒä»“ç›¸å…³å­—æ®µ
- [ ] ä¿®æ”¹ `formatSignalMarkdown` æ–¹æ³•ï¼Œæ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼
- [ ] ä¿®æ”¹ `formatSignalRichText` æ–¹æ³•ï¼Œæ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼
- [ ] ä¿®æ”¹ `SendSignal` æ–¹æ³•ï¼Œä¼ é€’æŒä»“ä¿¡æ¯

#### 7. `web/config.html`

- [ ] æ·»åŠ æŒä»“ä¿¡æ¯è¾“å…¥åŒºåŸŸ
- [ ] ä¿®æ”¹ `collectFormData` å‡½æ•°ï¼Œæ”¶é›†æŒä»“ä¿¡æ¯

---

## é…ç½®ç¤ºä¾‹

### ç›‘æ§æ¨¡å¼é…ç½®ï¼ˆåŸæœ‰æ–¹å¼ï¼Œä¸å¡«å†™æŒä»“ä¿¡æ¯ï¼‰

```json
{
  "code": "603881",
  "name": "æ•°æ®æ¸¯",
  "enabled": true,
  "scan_interval_minutes": 5,
  "min_confidence": 75
}
```

### æŒä»“æ¨¡å¼é…ç½®ï¼ˆæ–°å¢æ–¹å¼ï¼Œå¡«å†™æŒä»“ä¿¡æ¯ï¼‰

```json
{
  "code": "002842",
  "name": "ç¿”é¹­è‚¡ä»½",
  "enabled": true,
  "scan_interval_minutes": 5,
  "min_confidence": 75,
  "position_quantity": 1000,
  "buy_price": 12.50,
  "buy_date": "2025-01-15"
}
```

### æ··åˆé…ç½®ï¼ˆä¸¤ç§æ¨¡å¼å…±å­˜ï¼‰

```json
{
  "stocks": [
    {
      "code": "603881",
      "name": "æ•°æ®æ¸¯",
      "enabled": true,
      "scan_interval_minutes": 5,
      "min_confidence": 75
    },
    {
      "code": "002842",
      "name": "ç¿”é¹­è‚¡ä»½",
      "enabled": true,
      "scan_interval_minutes": 5,
      "min_confidence": 75,
      "position_quantity": 1000,
      "buy_price": 12.50,
      "buy_date": "2025-01-15"
    }
  ]
}
```

---

## AIæç¤ºè¯ç¤ºä¾‹

### ç›‘æ§æ¨¡å¼æç¤ºè¯ï¼ˆåŸæœ‰æ–¹å¼ï¼‰

```
## å®æ—¶è¡Œæƒ…æ•°æ®
- **å½“å‰ä»·æ ¼**: 13.20å…ƒ
- **ä»Šæ—¥å¼€ç›˜**: 12.80å…ƒ
- **æœ€é«˜ä»·**: 13.50å…ƒ
- **æœ€ä½ä»·**: 12.75å…ƒ
...

## æŠ€æœ¯æŒ‡æ ‡
- **MA5**: 12.90å…ƒ
- **MA10**: 12.70å…ƒ
...

## åˆ†æè¦æ±‚
è¯·åŸºäºä»¥ä¸Šæ•°æ®è¿›è¡Œ**å…¨é¢çš„æŠ€æœ¯åˆ†æ**ï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„æ“ä½œå»ºè®®ã€‚
```

### æŒä»“æ¨¡å¼æç¤ºè¯ï¼ˆæ–°å¢æ–¹å¼ï¼‰

```
## å®æ—¶è¡Œæƒ…æ•°æ®
- **å½“å‰ä»·æ ¼**: 13.20å…ƒ
...

## æŠ€æœ¯æŒ‡æ ‡
- **MA5**: 12.90å…ƒ
...

## æŒä»“ä¿¡æ¯
- **æŒä»“æ•°é‡**: 1000è‚¡
- **è´­ä¹°ä»·æ ¼**: 12.50å…ƒ/è‚¡
- **æŒä»“æˆæœ¬**: 12,500å…ƒ
- **å½“å‰ä»·æ ¼**: 13.20å…ƒ/è‚¡
- **å¸‚å€¼**: 13,200å…ƒ
- **æµ®åŠ¨ç›ˆäº**: +700å…ƒ (+5.6%)

## åˆ†æè¦æ±‚

è¯·åŸºäºä»¥ä¸Šæ•°æ®ï¼ˆåŒ…æ‹¬æŒä»“ä¿¡æ¯ï¼‰è¿›è¡Œ**å…¨é¢çš„æŠ€æœ¯åˆ†æå’ŒæŒä»“è¯„ä¼°**ï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„æ“ä½œå»ºè®®ã€‚

**ç‰¹åˆ«è¦æ±‚**: å¦‚æœå»ºè®®å–å‡ºæˆ–æŒæœ‰ï¼Œè¯·æ ¹æ®æŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æï¼Œæ˜ç¡®ç»™å‡ºï¼š
- **æŒä»“æ­¢ç›ˆä»·**: å»ºè®®çš„æ­¢ç›ˆä»·æ ¼ï¼ˆå…ƒï¼‰
- **æŒä»“æ­¢æŸä»·**: å»ºè®®çš„æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼‰

## è¾“å‡ºæ ¼å¼

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼ˆåªè¾“å‡ºJSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ï¼‰:

```json
{
  "signal": "BUY æˆ– SELL æˆ– HOLD",
  "confidence": 0-100çš„æ•´æ•°,
  "reasoning": "è¯¦ç»†çš„åˆ†æç†ç”±",
  "target_price": ç›®æ ‡ä»·æ ¼ï¼ˆå…ƒï¼‰,
  "stop_loss": æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼‰,
  "risk_reward": "é£é™©å›æŠ¥æ¯”",
  "position_profit_target": æŒä»“æ­¢ç›ˆä»·æ ¼ï¼ˆå…ƒï¼‰ï¼ŒåŸºäºæŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æç»™å‡º,
  "position_stop_loss": æŒä»“æ­¢æŸä»·æ ¼ï¼ˆå…ƒï¼‰ï¼ŒåŸºäºæŒä»“æˆæœ¬ä»·å’ŒæŠ€æœ¯åˆ†æç»™å‡º
}
```
```

---

## é€šçŸ¥ç¤ºä¾‹

### ç›‘æ§æ¨¡å¼é€šçŸ¥ï¼ˆåŸæœ‰æ–¹å¼ï¼‰

```
ğŸ“Š è‚¡ç¥¨: æ•°æ®æ¸¯ (603881)
ğŸ’° å½“å‰ä»·æ ¼: 13.20å…ƒ
ğŸ“ˆ ä¿¡å·: BUY
ğŸ¯ ä¿¡å¿ƒåº¦: 85%
...
```

### æŒä»“æ¨¡å¼é€šçŸ¥ï¼ˆæ–°å¢æ–¹å¼ï¼‰

```
ğŸ“Š è‚¡ç¥¨: ç¿”é¹­è‚¡ä»½ (002842)
ğŸ’° å½“å‰ä»·æ ¼: 13.20å…ƒ
ğŸ“ˆ ä¿¡å·: HOLD
ğŸ¯ ä¿¡å¿ƒåº¦: 80%

ğŸ“Š æŒä»“ä¿¡æ¯:
- æŒä»“æ•°é‡: 1000è‚¡
- è´­ä¹°ä»·æ ¼: 12.50å…ƒ/è‚¡
- å½“å‰ä»·æ ¼: 13.20å…ƒ/è‚¡
- æµ®åŠ¨ç›ˆäº: +700å…ƒ (+5.6%)

ğŸ“ˆ æŒä»“æ­¢ç›ˆä»·: 14.50å…ƒ
ğŸ“‰ æŒä»“æ­¢æŸä»·: 12.00å…ƒ

...
```

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1: ç›‘æ§æ¨¡å¼ï¼ˆå‘åå…¼å®¹ï¼‰

**æ­¥éª¤**:
1. é…ç½®ä¸€åªè‚¡ç¥¨ï¼Œä¸å¡«å†™æŒä»“ä¿¡æ¯
2. å¯åŠ¨ç³»ç»Ÿå¹¶åˆ†æ
3. æ£€æŸ¥åˆ†æç»“æœå’Œé€šçŸ¥

**é¢„æœŸ**:
- âœ… æŒ‰åŸæœ‰æ–¹å¼è¿è¡Œï¼ŒåŠŸèƒ½æ— å˜åŒ–
- âœ… é€šçŸ¥ä¸­ä¸æ˜¾ç¤ºæŒä»“ä¿¡æ¯
- âœ… AIåˆ†æç»“æœä¸åŒ…å«æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼

### æµ‹è¯•åœºæ™¯2: æŒä»“æ¨¡å¼ï¼ˆæ–°åŠŸèƒ½ï¼‰

**æ­¥éª¤**:
1. é…ç½®ä¸€åªè‚¡ç¥¨ï¼Œå¡«å†™æŒä»“æ•°é‡1000è‚¡ï¼Œè´­ä¹°ä»·æ ¼12.50å…ƒ
2. å¯åŠ¨ç³»ç»Ÿå¹¶åˆ†æï¼ˆå‡è®¾å½“å‰ä»·æ ¼13.20å…ƒï¼‰
3. æ£€æŸ¥AIæç¤ºè¯æ˜¯å¦åŒ…å«æŒä»“ä¿¡æ¯
4. æ£€æŸ¥AIåˆ†æç»“æœæ˜¯å¦åŒ…å«æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
5. æ£€æŸ¥é€šçŸ¥æ˜¯å¦æ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼

**é¢„æœŸ**:
- âœ… AIæç¤ºè¯åŒ…å«æŒä»“ä¿¡æ¯ï¼ˆæ•°é‡ã€ä»·æ ¼ã€ç›ˆäºï¼‰
- âœ… AIåˆ†æç»“æœåŒ…å« `position_profit_target` å’Œ `position_stop_loss`
- âœ… é€šçŸ¥æ˜¾ç¤ºæŒä»“æ•°é‡ã€è´­ä¹°ä»·æ ¼ã€æµ®åŠ¨ç›ˆäº
- âœ… é€šçŸ¥æ˜¾ç¤ºæŒä»“æ­¢ç›ˆä»·å’Œæ­¢æŸä»·

### æµ‹è¯•åœºæ™¯3: æ··åˆæ¨¡å¼

**æ­¥éª¤**:
1. é…ç½®å¤šåªè‚¡ç¥¨ï¼Œéƒ¨åˆ†å¡«å†™æŒä»“ä¿¡æ¯ï¼Œéƒ¨åˆ†ä¸å¡«å†™
2. å¯åŠ¨ç³»ç»Ÿå¹¶åˆ†æ
3. æ£€æŸ¥æ¯åªè‚¡ç¥¨çš„åˆ†æç»“æœå’Œé€šçŸ¥

**é¢„æœŸ**:
- âœ… æœ‰æŒä»“ä¿¡æ¯çš„æŒ‰æŒä»“æ¨¡å¼è¿è¡Œ
- âœ… æ— æŒä»“ä¿¡æ¯çš„æŒ‰ç›‘æ§æ¨¡å¼è¿è¡Œ
- âœ… é€šçŸ¥æ ¼å¼æ­£ç¡®

---

## å®æ–½æ­¥éª¤

### ç¬¬ä¸€æ­¥: å¿«é€ŸéªŒè¯ï¼ˆ1-2å°æ—¶ï¼‰

1. æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æŒä»“ä¿¡æ¯æµ‹è¯•
2. ä¿®æ”¹ `buildAnalysisPrompt`ï¼Œæ·»åŠ æŒä»“ä¿¡æ¯åˆ°æç¤ºè¯
3. ä¿®æ”¹ `SendSignal`ï¼Œåœ¨é€šçŸ¥ä¸­æ˜¾ç¤ºæŒä»“ä¿¡æ¯
4. æµ‹è¯•éªŒè¯

### ç¬¬äºŒæ­¥: å®Œæ•´å®ç°ï¼ˆ8-10å°æ—¶ï¼‰

1. æŒ‰ç…§ä»£ç ä¿®æ”¹æ¸…å•ï¼Œå®Œæˆæ‰€æœ‰ä¿®æ”¹
2. å®Œå–„é…ç½®éªŒè¯
3. å®Œå–„Webç•Œé¢
4. å®Œæ•´æµ‹è¯•

### ç¬¬ä¸‰æ­¥: ä¼˜åŒ–å®Œå–„ï¼ˆ2-3å°æ—¶ï¼‰

1. ä¼˜åŒ–AIæç¤ºè¯
2. ä¼˜åŒ–é€šçŸ¥æ ¼å¼
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

**æ€»è®¡é¢„ä¼°æ—¶é—´**: 11-15å°æ—¶ï¼ˆçº¦1.5-2ä¸ªå·¥ä½œæ—¥ï¼‰

---

## æ³¨æ„äº‹é¡¹

### 1. å‘åå…¼å®¹

- âœ… ä¸å¡«å†™æŒä»“ä¿¡æ¯æ—¶ï¼ŒæŒ‰ç›‘æ§æ¨¡å¼è¿è¡Œï¼Œå®Œå…¨å…¼å®¹
- âœ… æ–°å­—æ®µä¸ºå¯é€‰ï¼ˆ`omitempty`ï¼‰ï¼Œæ—§é…ç½®å¯æ­£å¸¸åŠ è½½

### 2. æ•°æ®éªŒè¯

- âœ… æŒä»“æ•°é‡å’Œè´­ä¹°ä»·æ ¼å¿…é¡»åŒæ—¶å¡«å†™ï¼ˆå¦‚æœå¡«å†™äº†å…¶ä¸­ä¸€ä¸ªï¼‰
- âœ… æŒä»“æ•°é‡å’Œè´­ä¹°ä»·æ ¼å¿…é¡»>0ï¼ˆå¦‚æœå¡«å†™äº†ï¼‰
- âœ… è´­ä¹°æ—¥æœŸæ ¼å¼éªŒè¯ï¼ˆYYYY-MM-DDï¼‰

### 3. AIæç¤ºè¯

- âš ï¸ ç¡®ä¿AIç†è§£æŒä»“æˆæœ¬æ¦‚å¿µ
- âš ï¸ æ˜ç¡®è¦æ±‚AIç»™å‡ºæŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
- âš ï¸ æµ‹è¯•ä¸åŒAIæä¾›å•†çš„å“åº”è´¨é‡

### 4. é€šçŸ¥æ ¼å¼

- âœ… æŒä»“æ¨¡å¼ä¸‹ï¼Œå¿…é¡»æ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼
- âœ… ç›‘æ§æ¨¡å¼ä¸‹ï¼Œä¸æ˜¾ç¤ºæŒä»“ç›¸å…³å­—æ®µ
- âœ… æ ¼å¼æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»

---

## æ€»ç»“

### æ ¸å¿ƒè®¾è®¡

1. **ä¸¤ç§æ¨¡å¼**: ç›‘æ§æ¨¡å¼ï¼ˆåŸæœ‰ï¼‰å’ŒæŒä»“æ¨¡å¼ï¼ˆæ–°å¢ï¼‰
2. **å‘åå…¼å®¹**: ä¸å¡«å†™æŒä»“ä¿¡æ¯æ—¶ï¼ŒæŒ‰åŸæœ‰æ–¹å¼è¿è¡Œ
3. **çµæ´»é…ç½®**: æ”¯æŒä¸¤ç§æ¨¡å¼å…±å­˜
4. **AIå¢å¼º**: åœ¨åŸæœ‰æŠ€æœ¯åˆ†æåŸºç¡€ä¸Šï¼Œæ·»åŠ æŒä»“ä¿¡æ¯
5. **é€šçŸ¥å¢å¼º**: æ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼

### å…³é”®ä¿®æ”¹ç‚¹

1. **é…ç½®æ‰©å±•**: æ·»åŠ å¯é€‰çš„æŒä»“å­—æ®µ
2. **æç¤ºè¯å¢å¼º**: åœ¨AIæç¤ºè¯ä¸­æ·»åŠ æŒä»“ä¿¡æ¯
3. **å“åº”æ‰©å±•**: è§£æAIè¿”å›çš„æŒä»“æ­¢ç›ˆæ­¢æŸä»·æ ¼
4. **é€šçŸ¥å¢å¼º**: åœ¨é€šçŸ¥ä¸­æ˜¾ç¤ºæŒä»“ä¿¡æ¯å’Œæ­¢ç›ˆæ­¢æŸä»·æ ¼

### å®æ–½å»ºè®®

1. **å…ˆéªŒè¯å†å®ç°**: å¿«é€ŸéªŒè¯å¯è¡Œæ€§
2. **é€æ­¥å®Œå–„**: å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†ä¼˜åŒ–ç»†èŠ‚
3. **å……åˆ†æµ‹è¯•**: ç¡®ä¿å‘åå…¼å®¹å’Œæ–°åŠŸèƒ½æ­£å¸¸

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£ä½œä¸ºæŒä»“æ¨¡å¼åŠŸèƒ½çš„å®æ–½å‚è€ƒï¼Œè¯¦ç»†åˆ—å‡ºäº†æ‰€æœ‰éœ€è¦ä¿®æ”¹çš„ä»£ç å’Œæ­¥éª¤ã€‚æŒ‰ç…§æ­¤æ–‡æ¡£å¯ä»¥å®Œæ•´å®ç°è¯¥åŠŸèƒ½ã€‚*

